<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="NingBo"><meta name="description" conauthortent="宁勃的博客"><link rel="alternative" href="/atom.xml" title="NingBo'Blog" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>javaScript和jQuery实现拖拽效果 - NingBo'Blog</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0;"><header class="head"><h1 class="head-title u-fl"><a href="/">NingBo'Blog</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2016-11-10T06:46:24.000Z">十一月 10, 2016</time><h1 class="post__title"><a href="/2016/11/10/js-and-jq-drag/">javaScript和jQuery实现拖拽效果</a></h1><div class="post__main echo"><h1 id="javaScript实现拖拽效果"><a href="#javaScript实现拖拽效果" class="headerlink" title="javaScript实现拖拽效果"></a>javaScript实现拖拽效果</h1><p>鼠标按下移动或者手指拖动对象，对象随之移动，鼠标放开或者手指离开屏幕，对象停止移动。</p>
<h2 id="Event对象介绍"><a href="#Event对象介绍" class="headerlink" title="Event对象介绍"></a>Event对象介绍</h2><p>Event对象代表事件的状态，比如事件在其中发生的元素、键盘按键的状态、鼠标的位置、鼠标按钮的状态。</p>
<p>事件通常与函数结合使用，函数不会在事件发生前被执行。</p>
<h3 id="事件句柄"><a href="#事件句柄" class="headerlink" title="事件句柄"></a>事件句柄</h3><ul>
<li>onmousedown 鼠标按钮被按下</li>
<li>onmousemove 鼠标被移动</li>
<li>onmouseup 鼠标从某元素移开</li>
</ul>
<h3 id="鼠标属性"><a href="#鼠标属性" class="headerlink" title="鼠标属性"></a>鼠标属性</h3><ul>
<li>clientX 返回返回当事件被触发时鼠标指针向对于浏览器页面（或客户区）的水平坐标。</li>
<li>注释：2 级 DOM 没有提供把窗口坐标转换为文档坐标的标准方法。在 IE 以外的浏览器，使用 window.pageXOffset 和 window.pageYOffset 即可。</li>
<li>clientY 返回当事件被触发时鼠标指针向对于浏览器页面（客户区）的垂直坐标。</li>
<li>注释：注意，该坐标不考虑文档的滚动。如果事件发生在窗口的顶部，无论文档滚了多远，clientY 的值都是 0。但是，2 级 DOM 没有提供把窗口坐标转换为文档坐标的标准方法。在 IE 以外的浏览器，使用 window.pageXOffset 和 window.pageYOffset 即可</li>
<li>screenX 返回事件发生时鼠标指针相对于屏幕的水平坐标。</li>
<li>screenY 返回事件发生时鼠标指针相对于屏幕的垂直坐标。</li>
<li>offsetX,offsetY 发生事件的地点在事件源元素的坐标系统中的 x 坐标和 y 坐标。</li>
<li>offsetLeft 返回当前元素的相对水平偏移位置的偏移容器。</li>
<li>offsetTop 返回当前元素的相对垂直偏移位置的偏移容器</li>
<li>offsetHeight 返回，任何一个元素的高度包括边框和填充，但不是边距</li>
<li>offsetWidth 返回元素的宽度，包括边框和填充，但不是边距</li>
<li>offsetParent 返回元素的偏移容器</li>
<li>jQuery event.pageX 返回相对于文档左边缘的鼠标位置</li>
<li>jQuery event.pageY 返回相对于文档上边缘的鼠标位</li>
</ul>
<h2 id="javaScript实现"><a href="#javaScript实现" class="headerlink" title="javaScript实现"></a>javaScript实现</h2><ul>
<li>onmousedown</li>
<li>document.onmousemove</li>
<li><p>document.onmouseup</p>
<p>  //鼠标按下<br>  var div1 = document.getElementById(“div1”);<br>  div1.onmousedown = function(ev){</p>
<pre><code>var ev = ev || event;
//获取鼠标距离元素左边和上边的距离
//方式1：火狐旧版本不支持
//var offsetX = ev.offsetX;
//var offsetY = ev.offsetY;
//方式2
var offsetX = ev.clientX - ev.offsetLeft;
var offsetY = ev.clientY - ev.offsetTop;

//鼠标按下
document.onmousemove = function(ev){
    var ev = ev || event;
    div1.style.left = ev.clientX - this.offsetX + &quot;px&quot;;
    div1.style.top = ev.clientY - this.offsetY + &quot;px&quot;;
};
//鼠标抬起，取消移动事件
document.onmouseup = function(){
    document.onmouseup = document.onmousemove = null;
}；

return false;
</code></pre><p>  };</p>
</li>
</ul>
<p><strong>javaScript实现移动端拖拽</strong></p>
<pre><code>var isdrag=false;   
var NowLeft,disX;
var NowTop,disY; 
var oDiv2 = document.getElementById(&quot;gamecar&quot;);
oDiv2.addEventListener(&apos;touchstart&apos;,thismousedown);  
oDiv2.addEventListener(&apos;touchend&apos;,thismouseup);  
oDiv2.addEventListener(&apos;touchmove&apos;,thismousemove);  
function thismousedown(e){
    isdrag = true;   
    console.log(e);
    NowLeft = oDiv2.offsetLeft;  
    NowTop = oDiv2.offsetTop;   
    disX = e.touches[0].pageX;
    disY = e.touches[0].pageY;
    return false;
}
function thismousemove(e){   
    if(isdrag){
           oDiv2.style.left = NowLeft + e.touches[0].pageX - disX + &apos;px&apos;; 
           oDiv2.style.top = NowTop + e.touches[0].pageY - disY + &apos;px&apos;;
           return false;   
    }   
}   
function thismouseup(){  
    isdrag = false;  
};
</code></pre><p><strong>jQuery实现鼠标拖拽效果</strong></p>
<pre><code>//鼠标按下
$(&quot;#gamecar&quot;).on(&quot;mousedown&quot;,function(ev){
    var ev = ev || window.event;
    var offsetX = ev.offsetX;
    var offsetY = ev.offsetY;
    //鼠标移动
    $(document).on(&quot;mousemove&quot;,function(ev){
        var ev = ev || window.event;
        var carLeft = ev.clientX - offsetX + &quot;px&quot;;
        var carTop = ev.clientY - offsetY + &quot;px&quot;;
        $(&quot;#gamecar&quot;).css({
            left: carLeft,
            top: carTop
        });
    });
    //鼠标移开
    $(document).on(&quot;mouseup&quot;,function(){
        //移除元素所有的事件处理器
        $(document).unbind();
    });
    return false;
});
</code></pre><h2 id="完整代码示范"><a href="#完整代码示范" class="headerlink" title="完整代码示范"></a>完整代码示范</h2><pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;&lt;/title&gt;
&lt;style&gt;
    *{
        padding: 0;
        margin: 0;
    }
    #div1{
        width: 100px;
        height: 100px;
        background-color: red;
        position: absolute;
        left: 100px;
        top: 200px;
        border-radius: 50%;
        box-shadow: 0 0 2px 3px red;
    }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id=&quot;div1&quot;&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
var div1 = document.getElementById(&apos;div1&apos;);

//鼠标按下
div1.onmousedown = function(ev){
    console.log(&apos;鼠标按下了&apos;);
    var ev = ev || event;

    //获取鼠标距离元素左边和上边的距离
    //方式1:火狐旧版本不兼容
    //var offsetX = ev.offsetX;
    //var offsetY = ev.offsetY;
    //方式2
    var offsetX = ev.clientX - this.offsetLeft;
    var offsetY = ev.clientY - this.offsetTop;

    document.onmousemove = function(ev){

        var ev = ev || event;
        console.log(ev.clientX,ev.clientY);

        div1.style.left = ev.clientX - offsetX + &apos;px&apos;;
        div1.style.top = ev.clientY - offsetY + &apos;px&apos;;
    };

    //鼠标抬起，取消移动事件
    document.onmouseup = function(){
        document.onmouseup = document.onmousemove = null;
    };

    return false;
};

/*
 三步：
 1.元素onmousedown
 2.document.onmousemove
 3.documnet.onmouseup
 **/
&lt;/script&gt;
&lt;/html&gt;
</code></pre></div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/javaScript-jQuery-拖拽/">javaScript jQuery 拖拽</a></li></ul></footer></article><section class="reward"> <a class="btn-reward" href="#">打赏</a><div class="reward-wrapper clearfix"><img src="/img/wechat.png" title="微信"></div></section><div class="comments" id="lv-container" data-id="city" data-uid="your uid"><script>(function(d, s) {var j, e = d.getElementsByTagName(s)[0];if (typeof LivereTower === 'function') { return; } j = d.createElement(s);j.src = 'https://cdn-city.livere.com/js/embed.dist.js';j.async = true;e.parentNode.insertBefore(j, e);})(document, 'script');</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2017 NingBo</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>